---
title: 'Reactì™€ History API ì‚¬ìš©í•˜ì—¬ SPA Router ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸° (react-router-dom ë¼ì´ë¸ŒëŸ¬ë¦¬ ëœ¯ì–´ë³´ê¸°)'
date: '2022-10-06'
tags: ['React', 'SPA', 'Router', 'History API', 'react-router-dom']
---

ì–´ë–»ê²Œ í•´ê²°í•´ì•¼ ë  ì§€ ìƒê°í•´ë³´ì..

ì–´ì œ ì§„í–‰í–ˆë˜ ê°•ì˜ì—ì„œ í‹°ìŠ¤í† ë¦¬ë‚˜, ë²¨ë¡œê·¸ë¥¼ ì°¸ê³ í•˜ê¸° ë³´ë‹¤ëŠ” ê³µì‹ë¬¸ì„œì™€ ì˜¤í”ˆì†ŒìŠ¤ë¥¼ ë³´ëŠ”ê²Œ ì¢‹ë‹¤ê³  ì–¸ê¸‰í•´ì£¼ì…¨ìœ¼ë‹ˆ ìµœëŒ€í•œ ê³µì‹ ë ˆí¼ëŸ°ìŠ¤ì—ì„œ ì°¸ê³ ë¥¼ ë§ì´ í•´ë³´ì.

> ê·¼ë° ì‚¬ì‹¤ ì´ë²ˆì— ì§„í–‰í•˜ëŠ” ì£¼ì œë¥¼ êµ¬í˜„í•´ë†“ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì´ë¯¸ ìˆì§€ ì•Šë‚˜?

ë°”ë¡œ ë§ì´ ì‚¬ìš©í–ˆë˜ react-router-dom ì´ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ë°, í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— Routerë¥¼ ë‹´ë‹¹í•˜ëŠ” Link ë¼ëŠ” ê¸°ëŠ¥ì´ ìˆê¸° ë•Œë¬¸ì— react-router-domì˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë³´ë©´ ì •ë‹µì´ ìˆì§€ ì•Šì„ê¹Œ?! ìƒê°í–ˆë‹¤.

https://github.com/remix-run/react-router

ì—¬ê¸° ë“¤ì–´ê°€ë³´ë©´ react-routerì˜ ì½”ë“œë¥¼ í›”ì³ë³¼ ìˆ˜ ìˆë‹¤.

react-router-domì´ ì–´ë”¨ì§€ ì–´ë”¨ì§€.. ì°¾ì•„ë³´ë‹ˆê¹Œ, packagesë¼ëŠ” í´ë” ì•ˆì— ë³´ë©´ react-router-domì´ë¼ëŠ” í´ë”ê°€ ìˆë‹¤.

ê·¸ ì¤‘ì—ì„œë„ Linkë¥¼ ì–´ë”” êµ¬í˜„í–ˆëŠ”ì§€ ì°¾ì•„ë³´ë‹ˆê¹Œ, index.tsx íŒŒì¼ì—ì„œ ì°¾ì„ ìˆ˜ ìˆì—ˆë‹¤.

![](https://velog.velcdn.com/images/ctdlog/post/0869044b-e59a-47eb-a0db-ea7bbee00615/image.png)

ë­ê°€ ë§ì€ë°, ì–´ì¨Œë“  a íƒœê·¸ë¥¼ ë§Œë“¤ì–´ì„œ ë°˜í™˜í•˜ê³  ìˆê³  a íƒœê·¸ì— ë­”ê°€ ì£¼ë ì£¼ë  ë‹¬ë ¤ìˆë‹¤.

ìœ„ì—ì„œ ë¶€í„° ì²œì²œíˆ ì½ì–´ë³´ìë¼ê³  ìƒê°í–ˆëŠ”ë°, ì²˜ìŒë¶€í„° ë§‰í˜”ë‹¤. `forwardRefê°€ ë­”ë° ã…‹ã…‹`

---

### forwardRefì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì

https://ko.reactjs.org/docs/forwarding-refs.html

ë¦¬ì•¡íŠ¸ ê³µì‹ë¬¸ì„œì—ì„œ forwardRefì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì.

ì­‰ ì½ì–´ë³´ë‹ˆê¹Œ, `Ref ì „ë‹¬í•˜ê¸°ëŠ” ì¼ë¶€ ì»´í¬ë„ŒíŠ¸ê°€ ìˆ˜ì‹ í•œ refë¥¼ ë°›ì•„ ì¡°ê¸ˆ ë” ì•„ë˜ë¡œ ì „ë‹¬(ì¦‰, "ì „ì†¡")í•  ìˆ˜ ìˆëŠ” ì˜µíŠ¸ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤.` ë¼ê³  ë˜ì–´ìˆë‹¤.

```ts
const FancyButton = React.forwardRef((props, ref) => (
  <button ref={ref} className="FancyButton">
    {props.children}
  </button>
));

// ì´ì œ DOM ë²„íŠ¼ìœ¼ë¡œ refë¥¼ ì‘ì ‘ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
const ref = React.createRef();
<FancyButton ref={ref}>Click me!</FancyButton>;
```

![](https://velog.velcdn.com/images/ctdlog/post/c9161254-6341-4287-8db3-82c015022984/image.png)

ì•„.. refëŠ” propsë¡œ ì „ë‹¬ì´ ì•ˆë˜ë‹ˆê¹Œ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸í•œí…Œ ë„˜ê²¨ì£¼ë ¤ë©´ forwardRef í•¨ìˆ˜ë¥¼ ì¨ì„œ ë„˜ê¸°ëŠ”ê±°êµ¬ë‚˜.

ìŒ ê·¼ë° ì§€ê¸ˆ ë‚´ ìƒí™©ì€ refë¥¼ ë§Œë“¤ì–´ì„œ ë„˜ê²¨ì£¼ë ¤ëŠ”ê±´ ì•„ë‹Œë°.. ì¼ë‹¨ ë„˜ì–´ê°€ë³´ì.

---

### ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¸ê³„ ì—¬í–‰ ì‹œì‘

ì‹¤ì œë¡œ ë¼ìš°íŒ…ì„ í•˜ê²Œ í•˜ëŠ”ê±´ onClick ì´ë²¤íŠ¸ì—ì„œ ë°œìƒí•˜ëŠ” ê²ƒì¼í…ë° onClickì„ ë³´ë‹ˆê¹Œ reloadDocumentì˜ ê°’ì— ë”°ë¼ onClick ë˜ëŠ” handleClickì´ ì‹¤í–‰ëœë‹¤.

reloadDocumentì˜ íƒ€ì…ì„ ë³´ë‹ˆê¹Œ booleanì´ë©´ì„œ optionalì´ë‹¤.

https://reactrouter.com/en/v6.3.0/api#link

ê³µì‹ ë¬¸ì„œë¥¼ ë³´ë©´, ë§ ê·¸ëŒ€ë¡œ reloadDocumentëŠ” SPAë¥¼ ìœ„í•œ ë¼ìš°íŒ…ì„ í•˜ì§€ ì•Šê³ , ê¸°ì¡´ì˜ a íƒœê·¸ì²˜ëŸ¼ ë¸Œë¼ìš°ì €ê°€ ì´ë²¤íŠ¸ë¥¼ í•¸ë“¤ë§í•  ìˆ˜ ìˆê²Œ ë„˜ê²¨ì¤€ë‹¤.

![](https://velog.velcdn.com/images/ctdlog/post/8e04e9ca-8800-4606-b0ae-e162f8f87c49/image.png)

ë³´í†µì˜ ìƒí™©ì—ì„œëŠ” reloadDocumentë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì„ í…Œë‹ˆê¹Œ, handleClick í•¨ìˆ˜ê°€ ì‹¤í–‰ë  ê²ƒì´ë‹¤.

> handleClick í•¨ìˆ˜ì—ì„œëŠ” ë­˜ í• ê¹Œ?

```tsx
function handleClick(event: React.MouseEvent<HTMLAnchorElement, MouseEvent>) {
  if (onClick) onClick(event);
  if (!event.defaultPrevented) {
    internalOnClick(event);
  }
}
```

onClick ê°’ì— ë”°ë¼ onClick(event)ê°€ ì‹¤í–‰ë˜ê³ , event.defaultPreventedì˜ ê°’ì— ë‹¤ë¼ ë˜ ë¬´ì–¸ê°€ ì‹¤í–‰ë˜ê³  ìˆë‹¤.

onClickì€ ìœ„ì—ì„œ forwardRefì˜ ì½œë°± í•¨ìˆ˜ì˜ ì¸ìì—ì„œ ë°›ì•„ì˜¤ê³  ìˆëŠ”ë°, LinkPropsë¥¼ ë³´ë‹ˆê¹Œ onClickì´ ì—†ë‹¤.

```tsx
export interface LinkProps extends Omit<
  React.AnchorHTMLAttributes<HTMLAnchorElement>,
  'href'
> {
  reloadDocument?: boolean;
  replace?: boolean;
  state?: any;
  preventScrollReset?: boolean;
  relative?: RelativeRoutingType;
  to: To;
}
```

ìŒ? ê·¸ëŸ¼ onClickì€ ì–´ë””ì„œ ê°€ì ¸ì˜¤ëŠ”ê±°ì§€.. forwardRefì˜ íƒ€ì…ì„ ë³´ë©´ HTMLAnchorElement, LinkProps 2ê°œê°€ ê±¸ë ¤ìˆëŠ”ë°,

ì•„ ê·¸ëŸ¬ë©´ onClickì€ a íƒœê·¸ì— ìˆëŠ”ê±¸ ë§í•˜ëŠ”ê±°êµ¬ë‚˜.

ê·¸ë˜ì„œ onClick ì´ë²¤íŠ¸ê°€ ë„˜ì–´ì˜¤ë©´ ê·¸ê±¸ ì‹¤í–‰ì‹œì¼œì£¼ê³ ,
event.defaultPreventedê°€ ì•„ë‹ ë•ŒëŠ” internalOnclick í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ëŠ”ë°,
ì—¬ê¸°ì„œ event.defaultPreventedì´ ë­”ì§€ MDNì—ì„œ ì°¾ì•„ë´¤ë‹¤.

https://developer.mozilla.org/en-US/docs/Web/API/Event/defaultPrevented

```jsx
function stopLink(event) {
  event.preventDefault();
}

function logClick(event) {
  const log = document.getElementById('log');

  if (event.target.tagName === 'A') {
    log.innerText = event.defaultPrevented
      ? `Sorry, but you cannot visit this link!\n${log.innerText}`
      : `Visiting linkâ€¦\n${log.innerText}`;
  }
}

const a = document.getElementById('link2');
a.addEventListener('click', stopLink);
document.addEventListener('click', logClick);
```

ì €ë ‡ê²Œ event.preventDefault()ê°€ ê±¸ë ¤ìˆëŠ”ì§€, ì•ˆê±¸ë ¤ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ì¸ê°€ë³´ë‹¤.

ë‹¤ì‹œ ìœ„ë¡œ ëŒì•„ê°€ì„œ, !event.defaultPreventedëŠ” preventDefault()ê°€ ì•ˆê±¸ë ¤ìˆì„ ë•Œë¥¼ ì˜ë¯¸í•˜ëŠ” ê²ƒì´ë‹¤.

ìŒ? ì•ì—ì„œ reloadDocumentê°€ falseì¼ ë•Œ handleClickì´ ì‹¤í–‰ë˜ëŠ”ë°, ê·¸ë ‡ë‹¤ë©´ ìƒˆë¡œê³ ì¹¨ì„ ì•ˆí•˜ê² ë‹¤ëŠ” ëœ» ì•„ë‹Œê°€? ê·¼ë° ì™œ handleClick ë‚´ë¶€ì—ì„œ preventDefault()ê°€ ì•ˆë¼ìˆì„ ë•Œ, ë­”ê°€ ë‹¤ì‹œ ì‹¤í–‰í• ê¹Œ..

ì •ë¦¬í•˜ë©´, ì‚¬ìš©ìëŠ” reload(=ìƒˆë¡œê³ ì¹¨ ì•ˆí•¨)ë¥¼ í•˜ì§€ ì•Šê² ë‹¤ê³  ì˜µì…˜ì„ ì¤¬ëŠ”ë° ê·¸ë˜ì„œ ì‹¤í–‰ëœ handleClick í•¨ìˆ˜ ë‚´ë¶€ì—ì„œëŠ” event.preventDefault()ê°€ ì•ˆê±¸ë ¤ìˆìœ¼ë©´(=ìƒˆë¡œê³ ì¹¨ í• ê±°ì„) ë­”ê°€ ì‹¤í–‰í•˜ë„¤????

> ì•„! ì›ë˜ a íƒœê·¸ì—ëŠ” ìƒˆë¡œê³ ì¹¨ ë˜ëŠ”ê²Œ ê¸°ë³¸ ì˜µì…˜ì¸ë°, reload ì•ˆí•œë‹¤ê³  ì¤¬ìœ¼ë©´ ë‹¹ì—°íˆ event.preventDefault()ê°€ ì•ˆê±¸ë ¤ìˆì„í…Œë‹ˆê¹Œ internalOnclick í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì´ë²¤íŠ¸ë¥¼ ë§‰ì•„ì£¼ê³ , ë­”ê°€ ì‹¤í–‰í•˜ëŠ”ê±´ê°€?

ê·¼ë° ê·¸ëŸ¼ Linkì—ë‹¤ê°€ event.preventDefault() ê±¸ì–´ë²„ë¦¬ë©´ ì•„ë¬´ ê²ƒë„ ì•ˆí•˜ëŠ”ê±°ì•¼???

ê·¸ë˜ì„œ internalOnclickì„ ë³´ë‹ˆê¹Œ ì–˜ëŠ” useLinkClickHandlerì˜ ë°˜í™˜ê°’ì„ ë°›ëŠ”ê±°ë„¤.

ê·¸ëŸ¼ useLinkClickHandlerë¥¼ ë³´ì.

```tsx
export function useLinkClickHandler<E extends Element = HTMLAnchorElement>(
  to: To,
  {
    target,
    replace: replaceProp,
    state,
    preventScrollReset,
    relative,
  }: {
    target?: React.HTMLAttributeAnchorTarget;
    replace?: boolean;
    state?: any;
    preventScrollReset?: boolean;
    relative?: RelativeRoutingType;
  } = {},
): (event: React.MouseEvent<E, MouseEvent>) => void {
  let navigate = useNavigate();
  let location = useLocation();
  let path = useResolvedPath(to, { relative });

  return React.useCallback(
    (event: React.MouseEvent<E, MouseEvent>) => {
      if (shouldProcessLinkClick(event, target)) {
        event.preventDefault();

        // If the URL hasn't changed, a regular <a> will do a replace instead of
        // a push, so do the same here unless the replace prop is explicitly set
        let replace =
          replaceProp !== undefined
            ? replaceProp
            : createPath(location) === createPath(path);

        navigate(to, { replace, state, preventScrollReset, relative });
      }
    },
    [
      location,
      navigate,
      path,
      replaceProp,
      state,
      target,
      to,
      preventScrollReset,
      relative,
    ],
  );
}
```

ë˜ ë­”ê°€ë¥¼ ì”ëœ© ì‹¤í–‰í•˜ê³  ìˆëŠ”ë°, ì¤‘ê°„ì— ë³´ë©´ event.preventDefault()ê°€ ë³´ì´ê³  navigateë¥¼ ì‹¤í–‰í•˜ê³  ìˆë‹¤. ì–˜ê°€ ì´ë²¤íŠ¸ë¥¼ ë§‰ì•„ì£¼ê³  ë¼ìš°íŒ…ì„ í•´ì£¼ëŠ” ì§„ì§œ í•¨ìˆ˜êµ¬ë‚˜.

navigateëŠ” ë­”ê°€ ì´ë™í•˜ê¸° ì „ì— íŠ¹ì • ë¡œì§ì„ ë” ìˆ˜í–‰í•´ì•¼ ëœë‹¤ê±°ë‚˜, íŠ¹ì • ìƒí™©ì— ì´ë™ì´ ë˜ê²Œ í•˜ê³  ì‹¶ì„ ë•Œ ì“°ë˜ í•¨ìˆ˜ì˜€ëŠ”ë° ì•Œê³ ë³´ë‹ˆê¹Œ Linkê°€ useNavigateë¥¼ ì¨ì„œ ë§Œë“ ê±°êµ¬ë‚˜..... ì‹ ê¸°í•˜ë‹¤.

ì•„ë‹ˆ ê·¼ë° useNavigateë„ react-router-domì—ì„œ ë§Œë“  Hookì¸ë°, ìŸ¤ë¶€í„° ëœ¯ì–´ë´¤ì–´ì•¼ í•˜ëŠ”ê±° ì•„ë‹Œê°€ ì•„ ã…‹ã…‹ ğŸ˜©

ê·¸ë˜ì„œ useNavigateë¥¼ ì°¾ì•„ë´¤ë‹¤.. ì–˜ëŠ” react-routerì— ìˆë„¤

ë­ê°€ ë§ì€ë°..... ì—¬ê¸°ê°€ ì¤‘ìš”í•œ ë¶€ë¶„ì¸ ê²ƒ ê°™ë‹¤.

```tsx
if (basename !== '/') {
  path.pathname =
    path.pathname === '/' ? basename : joinPaths([basename, path.pathname]);
}

(!!options.replace ? navigator.replace : navigator.push)(
  path,
  options.state,
  options,
);
```

ìœ„ì— ì¡°ê±´ë¬¸ì€ ì´ì „ ê²½ë¡œê°€ ìˆìœ¼ë©´ ë¶™ì—¬ì„œ path ë§Œë“¤ì–´ì£¼ëŠ” ê²ƒ ê°™ê³ , ë°‘ì— ë³´ë©´ replaceì— ë”°ë¼ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ëŠ”ë° ì €ê²Œ optionì´ë¼ì„œ ë”°ë¡œ ê°’ì„ ì•ˆì£¼ë©´ ë³´í†µ navigator.pushê°€ ì‹¤í–‰ì´ ë  ê²ƒì´ë‹¤.

navigator.pushëŠ” ë­˜ í• ê¹Œ.. ì–´ì§€ëŸ½ë‹¤.

navigatorê°€ ì–´ë””ì„œ ë‚˜ì˜¨ê±´ê³  í•˜ë‹ˆ,

```ts
let { basename, navigator } = React.useContext(NavigationContext);
```

useContextë¥¼ ì¨ì„œ ì „ì—­ ìƒíƒœë¡œ ê´€ë¦¬í•˜ê³  ìˆëŠ”ê±°ì—ì„œ ê°€ì ¸ì˜¨ê±°ë„¤?

ê·¸ë˜ì„œ NavigationContextë¥¼ ë˜ ì°¾ìœ¼ëŸ¬ ê°”ë‹¤.

```tsx
export interface Navigator {
  createHref: History['createHref'];
  go: History['go'];
  push(to: To, state?: any, opts?: NavigateOptions): void;
  replace(to: To, state?: any, opts?: NavigateOptions): void;
}

interface NavigationContextObject {
  basename: string;
  navigator: Navigator;
  static: boolean;
}

export const NavigationContext = React.createContext<NavigationContextObject>(
  null!,
);
```

NavigationContextëŠ” createContextë¡œ NavigationContextObject ì–˜ë„¤ë“¤ì„ ë„£ëŠ”ê±´ê°€ë³´ë‹¤.

NavigationContextObjectë¥¼ ë³´ë©´, ì•ˆì— navigatorê°€ ìˆê³  navigatorì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë³´ë©´ pushê°€ ìˆë‹¤.

ê·¸ë˜ì„œ ì € pushë¥¼ ì°¾ìœ¼ëŸ¬ ë˜ í—¤ë©”ê³  ë‹¤ë‹˜..

```tsx
let navigator = React.useMemo((): Navigator => {
  return {
    createHref: router.createHref,
    go: (n) => router.navigate(n),
    push: (to, state, opts) =>
      router.navigate(to, {
        state,
        preventScrollReset: opts?.preventScrollReset,
      }),
    replace: (to, state, opts) =>
      router.navigate(to, {
        replace: true,
        state,
        preventScrollReset: opts?.preventScrollReset,
      }),
  };
}, [router]);
```

navigatorì— ìˆëŠ” pushë¥¼ ì°¾ê³  ë³´ë‹ˆê¹Œ ì–˜ëŠ” ë˜ router.navigateë¥¼ ì‹¤í–‰í•˜ëŠ”ê±°ì˜€ìŒ.

ê·¸ë˜ì„œ ë˜ routerë¥¼ ì°¾ìœ¼ëŸ¬ ê°”ìŠµë‹ˆë‹¤....

```jsx
// A Router instance can be created using `createRouter`:

// Create and initialize a router.  "initialize" contains all side effects
// including history listeners and kicking off the initial data fetch
let router = createRouter({
  // Routes array
  routes: ,
  // History instance
  history,
}).initialize()
```

ì €ê¸° createRouterë¼ëŠ” í•¨ìˆ˜ ì•ˆì— ìˆëŠ” initializeë¥¼ í˜¸ì¶œí•˜ë©´ routerë¥¼ ë°˜í™˜ì„ í•œë‹¤.

```tsx
// Initialize the router, all side effects should be kicked off from here.
// Implemented as a Fluent API for ease of:
//   let router = createRouter(init).initialize();
function initialize() {
  // If history informs us of a POP navigation, start the navigation but do not update
  // state.  We'll update our own state once the navigation completes
  unlistenHistory = init.history.listen(({ action: historyAction, location }) =>
    startNavigation(historyAction, location),
  );

  // Kick off initial data load if needed.  Use Pop to avoid modifying history
  if (!state.initialized) {
    startNavigation(HistoryAction.Pop, state.location);
  }

  return router;
}
```

ê±°ê¸°ì„œ ë˜ navigate í•¨ìˆ˜ë¥¼ ì°¾ì•„ë³´ê³  ê±°ê¸°ì„œ ë°˜í™˜í•˜ëŠ” startNavigationì„ ì°¾ì•„ì„œ

```tsx
return await startNavigation(historyAction, location, {
  submission,
  // Send through the formData serialization error if we have one so we can
  // render at the right error boundary after we match routes
  pendingError: error,
  preventScrollReset,
  replace: opts && opts.replace,
});
```

```ts
completeNavigation(location, {
  matches,
  loaderData,
  errors,
});
```

completeNavigationì„ ë˜ ì°¾ì•„ì„œ.......

```tsx
updateState({
  // Clear existing actionData on any completed navigation beyond the original
  // action, unless we're currently finishing the loading/actionReload state.
  // Do this prior to spreading in newState in case we got back to back actions
  ...(isActionReload ? {} : { actionData: null }),
  ...newState,
  ...newLoaderData,
  historyAction: pendingAction,
  location,
  initialized: true,
  navigation: IDLE_NAVIGATION,
  revalidation: 'idle',
  // Don't restore on submission navigations
  restoreScrollPosition: state.navigation.formData
    ? false
    : getSavedScrollPosition(location, newState.matches || state.matches),
  preventScrollReset: pendingPreventScrollReset,
});

if (isUninterruptedRevalidation) {
  // If this was an uninterrupted revalidation then do not touch history
} else if (pendingAction === HistoryAction.Pop) {
  // Do nothing for POP - URL has already been updated
} else if (pendingAction === HistoryAction.Push) {
  init.history.push(location, location.state);
} else if (pendingAction === HistoryAction.Replace) {
  init.history.replace(location, location.state);
}
```

ë³´ë©´ ë­”ê°€ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê³ , history.pushë¥¼ í•˜ëŠ”ë°

```tsx
function push(to: To, state?: any) {
  action = Action.Push;
  let location = createLocation(history.location, to, state);
  if (validateLocation) validateLocation(location, to);

  let historyState = getHistoryState(location);
  let url = history.createHref(location);

  // try...catch because iOS limits us to 100 pushState calls :/
  try {
    globalHistory.pushState(historyState, '', url);
  } catch (error) {
    // They are going to lose state here, but there is no real
    // way to warn them about it since the page will refresh...
    window.location.assign(url);
  }

  if (v5Compat && listener) {
    listener({ action, location });
  }
}
```

pushStateë¥¼ í•˜ëŠ”ê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

> ì¡°ê¸ˆ ì •ë¦¬í•´ë³´ë©´, ì´ë™í•  pathë¥¼ ìƒíƒœë¡œ ì €ì¥í•´ë‘ê³  ìƒíƒœì— ë”°ë¼ì„œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë³€ê²½í•´ì„œ ë Œë”ë§í•´ì£¼ê³  pushStateë¥¼ í†µí•´ì„œ ë¸Œë¼ìš°ì €ì— í‘œì‹œëœ ì£¼ì†Œë¥¼ ë³€ê²½í•œë‹¤.

```tsx
export function Routes({
  children,
  location,
}: RoutesProps): React.ReactElement | null {
  let dataRouterContext = React.useContext(DataRouterContext);
  // When in a DataRouterContext _without_ children, we use the router routes
  // directly.  If we have children, then we're in a descendant tree and we
  // need to use child routes.
  let routes =
    dataRouterContext && !children
      ? (dataRouterContext.router.routes as DataRouteObject[])
      : createRoutesFromChildren(children);
  return useRoutes(routes, location);
}
```

ì´ Routesë¼ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ DataRouterContext, ì•„ë§ˆë„ ì•„ê¹Œ ìœ„ì—ì„œ ì „ì—­ìƒíƒœë¡œ ê´€ë¦¬í•˜ê³  ìˆì„ pathë¥¼ êº¼ë‚´ì„œ ì´ë¦„ì´ ê°™ì€ Routeë¥¼ ì°¾ì•„ì„œ ì—°ê²°í•´ì¤€ë‹¤.

---

### ê·¸ë˜ì„œ ì–´ë–»ê²Œ êµ¬í˜„í•¨?

> 1.  pathë¥¼ ì „ì—­ìœ¼ë¡œ ê´€ë¦¬í•´ì„œ ë³€í™”í•  ë•Œ, match ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ì‹œí‚´
> 2.  pushState ì¨ì„œ ë¸Œë¼ìš°ì €ì— ë‚˜ì˜¤ëŠ” URL ë°”ê¿”ì¤Œ

pathë¥¼ ì „ì—­ ìƒíƒœë¡œ ë§Œë“¤ì–´ì•¼ í•¨. ê·¸ë˜ì•¼ Route ì»´í¬ë„ŒíŠ¸ì—ì„œ ë³€í™”ë¥¼ ê°ì§€í•˜ê³ , ë Œë”ë§ì„ ë‹¤ì‹œ í• í…Œë‹ˆê¹Œ..

ë¨¼ì € routerë¥¼ ë§Œë“¤ì–´ì„œ Context Providerë¥¼ ë§Œë“¤ì. ì—¬ê¸°ì„œëŠ” Providerë¥¼ ë§Œë“¤ê³  ìì‹ ì»´í¬ë„ŒíŠ¸ë“¤ì´ contextë¥¼ ê³µìœ í•  ìˆ˜ ìˆê²Œë” ë§Œë“¤ì–´ì¤€ë‹¤.

```tsx
import { useContext, useState } from 'react';
import { routerContext } from './routerContext';

export const Router = ({ children }: any) => {
  const [path, setPath] = useState(window.location.pathname);
  const changePath = (path: string) => {
    setPath(path);
  };
  const contextValue = {
    path,
    changePath,
  };

  return (
    <routerContext.Provider value={contextValue}>
      {children}
    </routerContext.Provider>
  );
};
```

ê³µìœ í•  ìƒíƒœë“¤ì€ pathì™€ changePathì¸ë° ìì‹ ì»´í¬ë„ŒíŠ¸ì—ì„œ changePathë¥¼ í†µí•´ì„œ ìƒíƒœë¥¼ ë³€í™”ì‹œí‚¤ë©´ Routes ì»´í¬ë„ŒíŠ¸ì—ì„œ ë³€í™”í•œ path ìƒíƒœë‘ ì¼ì¹˜í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì•„ì„œ ë Œë”ë§ ì‹œí‚¨ë‹¤.

```tsx
import { Children, useContext } from 'react';
import { routerContext } from './routerContext';

export const Routes = ({ children }: any) => {
  const { path } = useContext(routerContext);

  let element = null;

  Children.forEach(children, (child) => {
    if (child.props.path !== path) {
      return;
    }
    element = child.props.element;
  });

  return element;
};
```

ì—¬ê¸°ì„œ React.Childrenì´ë¼ëŠ”ê²Œ ìˆëŠ”ë° console.log ì°ì–´ë³´ë©´ ì´ëŸ°ê²Œ ë‚˜ì˜¨ë‹¤.

![ì—…ë¡œë“œì¤‘..](blob:https://velog.io/384c8bd3-9078-4a3f-ae28-1d2a16382541)

Childrenì€ forEachë‚˜ map ê°™ì€ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê³  í•˜ìœ„ ë…¸ë“œë“¤ì„ ë³´ì—¬ì¤€ë‹¤. ì¦‰, Routes ì•„ë˜ì—ë‹¤ê°€ Route ì—¬ëŸ¬ ê°œë¥¼ ë„£ê³  ë°˜ë³µë¬¸ì„ ëŒë©´ì„œ Routeì˜ propsì— ìˆëŠ” pathë¥¼ í™•ì¸í•œë‹¤. ì¼ì¹˜í•˜ë©´ elementë¥¼ í•´ë‹¹ Routeì˜ elementë¡œ ë°”ê¿€êº¼ê³ , elementë¥¼ ë°˜í™˜í•˜ë©´ ëœë‹¤.

```tsx
interface IProps {
  path: string;
  element: React.ReactNode;
}

export const Route = ({ path, element }: IProps) => null;
```

RouteëŠ” ê·¸ëƒ¥ ê»ë°ê¸°ìš©ì´ê³  elementë¥¼ ë„˜ê²¨ì¤„ê»€ë° ì–˜ë„¤ íƒ€ì…ì„ ì–´ë–»ê²Œ í•´ì•¼ë ì§€ ëª¨ë¥´ê² ë‹¤.. ë” ì°¾ì•„ë´ì•¼ì§€

ì–´ì¨Œë“  ì´ì œ App.tsxë¡œ ëŒì•„ê°€ì„œ ì–˜ë„¤ë¥¼ í•©ì³ì£¼ë©´ ëë‚œë‹¤.

```tsx
import About from './About';
import './App.css';
import Home from './Home';
import { Route } from './Route';
import { Router } from './Router';
import { Routes } from './Routes';

function App() {
  return (
    <div className="App">
      <Router>
        <Routes>
          <Route path="/" element={<Home />} />
          <Route path="/about" element={<About />} />
        </Routes>
      </Router>
    </div>
  );
}

export default App;
```

![](https://velog.velcdn.com/images/ctdlog/post/a39927bc-f126-4981-ab8a-ada68ac1dc40/image.gif)

ì´ì œ ìƒíƒœê°€ ë³€í•¨ì— ë”°ë¼, í™”ë©´ì— ë³´ì—¬ì§ˆ ì»´í¬ë„ŒíŠ¸ê°€ ë³€í•œë‹¤.

### ê·¼ë°, ì €ê±° ë³€ê²½í•˜ê³  ìƒˆë¡œê³ ì¹¨í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

contextì—ì„œ pathì˜ ì´ˆê¸°ê°’ì„ ë¸Œë¼ìš°ì €ì˜ URLì—ì„œ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì— í™ˆ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°„ë‹¤. ê·¸ë˜ì„œ, ìƒíƒœê°€ ë³€í•  ë•Œ URLë„ ë³€ê²½ ì‹œì¼œì¤˜ì•¼ ë˜ëŠ”ë° ì—¬ê¸°ê°€ 2ë²ˆì´ë‹¤.

window.history ê°ì²´ì— pushStateë¼ëŠ” ë©”ì„œë“œê°€ ìˆë‹¤.

https://developer.mozilla.org/en-US/docs/Web/API/History/pushState

ì´ê±° ì“°ë©´ í˜ì´ì§€ ì „í™˜ì—†ì´ URLë§Œ ë°”ê¿”ì¤„ ìˆ˜ ìˆë‹¤.

ê·¸ë˜ì„œ ì•„ê¹Œ changePathí•  ë•Œ, pushStateë„ ê°™ì´ í•´ì£¼ë©´ ëœë‹¤.

```ts
const changePath = (path: string) => {
  setPath(path);
  history.pushState({ path }, '', path);
};
```

### ë’¤ë¡œ ê°€ê¸° ë¬¸ì œë„ í•´ê²°í•´ë³´ì!

í˜„ì¬ ìƒíƒœì—ì„œ ë’¤ë¡œ ê°€ê¸°ë¥¼ í•˜ë©´ ë¸Œë¼ìš°ì €ì˜ URLì€ ë³€ê²½ì´ ë˜ì§€ë§Œ í™”ë©´ì— ë³´ì´ëŠ” ì»´í¬ë„ŒíŠ¸ëŠ” ë³€ê²½ì´ ì•ˆëœë‹¤. pushStateë¥¼ í–ˆë˜ ê±¸ ë°˜ëŒ€ë¡œ ë’¤ë¡œê°€ê¸°ë¥¼ í•  ë•ŒëŠ”, popStateë¥¼ í•´ì¤˜ì•¼ëœë‹¤. ë’¤ë¡œ ê°€ê¸° ì´ë²¤íŠ¸ê°€ ë“¤ì–´ì˜¬ ë•Œ ë¸Œë¼ìš°ì €ì— ìŒ“ì¸ ìŠ¤íƒì„ êº¼ë‚´ì„œ, path ìƒíƒœë¥¼ ë³€ê²½í•´ì£¼ë©´ ëœë‹¤.

```ts
// Router.tsx
useEffect(() => {
  const handlePopstate = (event: PopStateEvent) => {
    setPath(event.state?.path || '/');
  };

  window.addEventListener('popstate', handlePopstate);

  return () => {
    window.removeEventListener('popstate', handlePopstate);
  };
}, []);
```

ì´ë ‡ê²Œ useEffect Hookì„ ì¶”ê°€í•´ì„œ, ìƒˆë¡œìš´ pathë¡œ ì´ë™í•  ë•Œ handlePopstateê°€ í˜¸ì¶œì´ ë˜ë©´ì„œ path ìƒíƒœë¥¼ ë³€ê²½í•´ì£¼ë©´ ë’¤ë¡œê°€ê¸°ë„ ì •ìƒì ìœ¼ë¡œ ëœë‹¤.

#### ë—
